<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tile Game</title>
    <!-- Include Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            height: 100vh;
            margin: 0;
        }
        .container-fluid {
            height: 100%;
        }
        .row {
            height: 100%;
        }
        .controls {
            display: flex;
            flex-direction: column;
            margin-right: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .grid-container {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            height: 100%;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(8, 100px);
            grid-template-rows: repeat(8, 100px);
            gap: 5px;
        }
        .tile {
            width: 100px;
            height: 100px;
            background-color: lightblue; /* Non-path tiles */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            position: relative;
            transition: background-color 0.3s, filter 0.3s;
        }
        .tracker-full-brightness .tile:not(.tracker) {
            filter: brightness(0.7);
        }
        .tracker-border .tracker {
            border: 5px solid black;
        }
        .tracker-pattern .tracker {
            background-image: linear-gradient(45deg, rgba(255,255,255,0.25) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.25) 50%, rgba(255,255,255,0.25) 75%, transparent 75%, transparent);
            background-size: 20px 20px;
        }
        .tracker-pulse .tracker {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .tracker-highlight-shadow .tracker {
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        }
        #tracker-info, #distance-info, #error-message {
            font-size: 18px;
            margin-top: 10px;
        }
        #error-message {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="controls">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Controls</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><button id="move-1-btn" class="btn btn-primary mb-2" onclick="moveTiles(1)">Jump 1 Tile</button></td>
                            </tr>
                            <tr>
                                <td><button id="move-2-btn" class="btn btn-primary mb-2" onclick="moveTiles(2)">Jump 2 Tiles</button></td>
                            </tr>
                            <tr>
                                <td><button id="move-3-btn" class="btn btn-primary mb-2" onclick="moveTiles(3)">Jump 3 Tiles</button></td>
                            </tr>
                            <tr>
                                <td><button id="move-4-btn" class="btn btn-primary mb-2" onclick="moveTiles(4)">Jump 4 Tiles</button></td>
                            </tr>
                            <tr>
                                <td><button id="move-5-btn" class="btn btn-primary mb-2" onclick="moveTiles(5)">Jump 5 Tiles</button></td>
                            </tr>
                            <tr>
                                <td><button id="move-6-btn" class="btn btn-primary mb-2" onclick="moveTiles(6)">Jump 6 Tiles</button></td>
                            </tr>
                            <tr>
                                <td><button id="roll-dice-btn" class="btn btn-secondary mb-2" onclick="rollDice()">Roll a Random Dice</button></td>
                            </tr>
                            <tr>
                                <td><button id="jump-dice-btn" class="btn btn-success mb-2" onclick="jumpDiceResult()">Jump Dice Result</button></td>
                            </tr>
                            <tr>
                                <td>
                                    <select id="tracker-style-switcher" class="form-control mt-2" onchange="changeTrackerStyle()">
                                        <option value="full-brightness">Full Brightness</option>
                                        <option value="border">Border</option>
                                        <option value="pattern">Patterned Background</option>
                                        <option value="pulse">Pulsing</option>
                                        <option value="highlight-shadow">Highlight Shadow</option>
                                    </select>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div id="dice-result" class="mt-2">Dice Result: N/A</div>
                    <div id="tracker-info">Current Position: (x: 0, y: 1)</div>
                    <div id="distance-info">Distance from Start: 0</div>
                    <div id="error-message"></div>
                </div>
            </div>
            <div class="col-md-9 grid-container">
                <div id="grid-wrapper">
                    <div class="grid tracker-full-brightness" id="grid">
                        <!-- The grid will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const gridSize = 8;
        let path = [];
        let currentStep = 0;
        let trackerPosition = null;
        let diceResult = null;
        const startPosition = { x: 0, y: 1 }; // Adjust this based on your starting tile

        const emojiMap = {
            'flag': 'üö©',
            'coin': 'ü™ô',
            'face': 'üòä',
            'diamond': 'üíé',
            'box': 'üì¶',
            'question-mark': '‚ùì',
            'blue-box': 'üü¶'
        };

        const rarityColors = {
            'grey': 'lightgrey',
            'green': 'green',
            'blue': 'blue',
            'purple': 'purple',
            'orange': 'orange'
        };

        const rarityThresholds = {
            'grey': 1,
            'green': 3,
            'blue': 7,
            'purple': 13,
            'orange': Infinity // Maxed out
        };

        async function loadTiles() {
            const response = await fetch('tiles.json');
            path = await response.json();
            trackerPosition = path[currentStep];
            createGrid();
            updateTrackerInfo();
        }

        function createGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const tile = document.createElement('div');
                    tile.classList.add('tile');
                    const tileData = path.find(p => p.x === x && p.y === y);
                    if (tileData) {
                        tile.textContent = emojiMap[tileData.type];
                        if (tileData.xp !== undefined) {
                            tile.dataset.xp = tileData.xp;
                            tile.dataset.rarity = tileData.rarity;
                            tile.style.backgroundColor = rarityColors[tileData.rarity];
                            tile.title = `XP: ${tileData.xp}/${rarityThresholds[tileData.rarity]} (Rarity: ${tileData.rarity})`;
                        }
                        if (x === trackerPosition.x && y === trackerPosition.y) {
                            tile.classList.add('tracker');
                        }
                    }
                    grid.appendChild(tile);
                }
            }
        }

        function moveTiles(steps) {
            currentStep = (currentStep + steps) % path.length;
            trackerPosition = path[currentStep];
            updateTrackerInfo();
            updateTileXp(trackerPosition);
            createGrid();
        }

        function rollDice() {
            diceResult = Math.floor(Math.random() * 6) + 1;
            document.getElementById('dice-result').textContent = `Dice Result: ${diceResult}`;
            document.getElementById('error-message').textContent = ''; // Clear any previous error
        }

        function jumpDiceResult() {
            if (diceResult === null) {
                document.getElementById('error-message').textContent = 'Error: Roll the dice first!';
            } else {
                moveTiles(diceResult);
                diceResult = null; // Reset dice result after the move
                document.getElementById('dice-result').textContent = 'Dice Result: N/A';
            }
        }

        function updateTileXp(position) {
            const tileData = path.find(p => p.x === position.x && p.y === position.y);
            if (tileData && tileData.xp !== undefined) {
                tileData.xp += 1;
                const currentRarity = tileData.rarity;
                if (tileData.xp >= rarityThresholds[currentRarity]) {
                    upgradeTileRarity(tileData);
                }
            }
        }

        function upgradeTileRarity(tileData) {
            const rarities = ['grey', 'green', 'blue', 'purple', 'orange'];
            const currentRarityIndex = rarities.indexOf(tileData.rarity);
            if (currentRarityIndex < rarities.length - 1) {
                tileData.rarity = rarities[currentRarityIndex + 1];
                tileData.xp = 0;
            }
        }

        function updateTrackerInfo() {
            const trackerInfo = document.getElementById('tracker-info');
            trackerInfo.textContent = `Current Position: (x: ${trackerPosition.x}, y: ${trackerPosition.y})`;

            const distance = calculateDistance(startPosition, trackerPosition);
            const distanceInfo = document.getElementById('distance-info');
            distanceInfo.textContent = `Distance from Start: ${distance}`;
        }

        function calculateDistance(start, current) {
            return Math.abs(start.x - current.x) + Math.abs(start.y - current.y);
        }

        function changeTrackerStyle() {
            const style = document.getElementById('tracker-style-switcher').value;
            const grid = document.getElementById('grid');
            grid.className = 'grid';  // Reset to just the grid class
            grid.classList.add(`tracker-${style}`);
        }

        loadTiles();
    </script>
</body>
</html>

